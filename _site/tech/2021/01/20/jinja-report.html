<!DOCTYPE html><html lang="en">
  <head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"><title>Create PDF reports with Python and Jinja2 - lin<sup>2</sup></title>

<meta name="description" content="This post is a summary of the code I wrote in Python for my then-desperate wife to automatically generate hundreds of invoices.Suppose you have an excel shee...">
<link rel="canonical" href="/tech/2021/01/20/jinja-report.html"><link rel="alternate" type="application/rss+xml" title="lin<sup>2</sup>" href="/feed.xml"><!-- start favicons snippet, use https://realfavicongenerator.net/ --><link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png"><link rel="manifest" href="/assets/site.webmanifest"><link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#fc4d50"><link rel="shortcut icon" href="/assets/favicon.ico">

<meta name="msapplication-TileColor" content="#ffc40d"><meta name="msapplication-config" content="/assets/browserconfig.xml">

<meta name="theme-color" content="#ffffff">
<!-- end favicons snippet --><link rel="stylesheet" href="/assets/css/main.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css" ><!-- start custom head snippets -->
<link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
<link rel="manifest" href="/assets/site.webmanifest">
<link rel="mask-icon" href="/assets/safari-pinned-tab.svg" color="#5bbad5">
<link rel="shortcut icon" href="/assets/favicon.ico">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" content="/assets/browserconfig.xml">
<meta name="theme-color" content="#ffffff">


<!-- end custom head snippets -->
<script>(function() {
  window.isArray = function(val) {
    return Object.prototype.toString.call(val) === '[object Array]';
  };
  window.isString = function(val) {
    return typeof val === 'string';
  };

  window.hasEvent = function(event) {
    return 'on'.concat(event) in window.document;
  };

  window.isOverallScroller = function(node) {
    return node === document.documentElement || node === document.body || node === window;
  };

  window.isFormElement = function(node) {
    var tagName = node.tagName;
    return tagName === 'INPUT' || tagName === 'SELECT' || tagName === 'TEXTAREA';
  };

  window.pageLoad = (function () {
    var loaded = false, cbs = [];
    window.addEventListener('load', function () {
      var i;
      loaded = true;
      if (cbs.length > 0) {
        for (i = 0; i < cbs.length; i++) {
          cbs[i]();
        }
      }
    });
    return {
      then: function(cb) {
        cb && (loaded ? cb() : (cbs.push(cb)));
      }
    };
  })();
})();
(function() {
  window.throttle = function(func, wait) {
    var args, result, thisArg, timeoutId, lastCalled = 0;

    function trailingCall() {
      lastCalled = new Date;
      timeoutId = null;
      result = func.apply(thisArg, args);
    }
    return function() {
      var now = new Date,
        remaining = wait - (now - lastCalled);

      args = arguments;
      thisArg = this;

      if (remaining <= 0) {
        clearTimeout(timeoutId);
        timeoutId = null;
        lastCalled = now;
        result = func.apply(thisArg, args);
      } else if (!timeoutId) {
        timeoutId = setTimeout(trailingCall, remaining);
      }
      return result;
    };
  };
})();
(function() {
  var Set = (function() {
    var add = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (data[i] === item) {
          return;
        }
      }
      this.size ++;
      data.push(item);
      return data;
    };

    var Set = function(data) {
      this.size = 0;
      this._data = [];
      var i;
      if (data.length > 0) {
        for (i = 0; i < data.length; i++) {
          add.call(this, data[i]);
        }
      }
    };
    Set.prototype.add = add;
    Set.prototype.get = function(index) { return this._data[index]; };
    Set.prototype.has = function(item) {
      var i, data = this._data;
      for (i = 0; i < data.length; i++) {
        if (this.get(i) === item) {
          return true;
        }
      }
      return false;
    };
    Set.prototype.is = function(map) {
      if (map._data.length !== this._data.length) { return false; }
      var i, j, flag, tData = this._data, mData = map._data;
      for (i = 0; i < tData.length; i++) {
        for (flag = false, j = 0; j < mData.length; j++) {
          if (tData[i] === mData[j]) {
            flag = true;
            break;
          }
        }
        if (!flag) { return false; }
      }
      return true;
    };
    Set.prototype.values = function() {
      return this._data;
    };
    return Set;
  })();

  window.Lazyload = (function(doc) {
    var queue = {js: [], css: []}, sources = {js: {}, css: {}}, context = this;
    var createNode = function(name, attrs) {
      var node = doc.createElement(name), attr;
      for (attr in attrs) {
        if (attrs.hasOwnProperty(attr)) {
          node.setAttribute(attr, attrs[attr]);
        }
      }
      return node;
    };
    var end = function(type, url) {
      var s, q, qi, cbs, i, j, cur, val, flag;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        s[url] = true;
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (cur.urls.has(url)) {
            qi = cur, val = qi.urls.values();
            qi && (cbs = qi.callbacks);
            for (flag = true, j = 0; j < val.length; j++) {
              cur = val[j];
              if (!s[cur]) {
                flag = false;
              }
            }
            if (flag && cbs && cbs.length > 0) {
              for (j = 0; j < cbs.length; j++) {
                cbs[j].call(context);
              }
              qi.load = true;
            }
          }
        }
      }
    };
    var load = function(type, urls, callback) {
      var s, q, qi, node, i, cur,
        _urls = typeof urls === 'string' ? new Set([urls]) : new Set(urls), val, url;
      if (type === 'js' || type ==='css') {
        s = sources[type], q = queue[type];
        for (i = 0; i < q.length; i++) {
          cur = q[i];
          if (_urls.is(cur.urls)) {
            qi = cur;
            break;
          }
        }
        val = _urls.values();
        if (qi) {
          callback && (qi.load || qi.callbacks.push(callback));
          callback && (qi.load && callback());
        } else {
          q.push({
            urls: _urls,
            callbacks: callback ? [callback] : [],
            load: false
          });
          for (i = 0; i < val.length; i++) {
            node = null, url = val[i];
            if (s[url] === undefined) {
              (type === 'js' ) && (node = createNode('script', { src: url }));
              (type === 'css') && (node = createNode('link', { rel: 'stylesheet', href: url }));
              if (node) {
                node.onload = (function(type, url) {
                  return function() {
                    end(type, url);
                  };
                })(type, url);
                (doc.head || doc.body).appendChild(node);
                s[url] = false;
              }
            }
          }
        }
      }
    };
    return {
      js: function(url, callback) {
        load('js', url, callback);
      },
      css: function(url, callback) {
        load('css', url, callback);
      }
    };
  })(this.document);
})();
</script><script>
  (function() {
    var TEXT_VARIABLES = {
      version: '2.2.6',
      sources: {
        font_awesome: 'https://cdn.bootcdn.net/ajax/libs/font-awesome/5.15.1/css/all.css',
        jquery: 'https://cdn.bootcss.com/jquery/3.1.1/jquery.min.js',
        leancloud_js_sdk: '//cdn.jsdelivr.net/npm/leancloud-storage@3.13.2/dist/av-min.js',
        chart: 'https://cdn.bootcss.com/Chart.js/2.7.2/Chart.bundle.min.js',
        gitalk: {
          js: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.js',
          css: 'https://cdn.bootcss.com/gitalk/1.2.2/gitalk.min.css'
        },
        valine: 'https://unpkg.com/valine/dist/Valine.min.js',
        mathjax: 'https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML',
        mermaid: 'https://cdn.bootcss.com/mermaid/8.0.0-rc.8/mermaid.min.js'
      },
      site: {
        toc: {
          selectors: 'h1,h2,h3'
        }
      },
      paths: {
        search_js: '/assets/search.js'
      }
    };
    window.TEXT_VARIABLES = TEXT_VARIABLES;
  })();
</script>
</head>
  <body>
    <div class="root" data-is-touch="false">
      <div class="layout--page js-page-root"><div class="page__main js-page-main page__viewport has-aside cell cell--auto">

      <div class="page__main-inner"><div class="page__header d-print-none"><header class="header"><div class="main">
      <div class="header__title">
        <div class="header__brand"><?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="50pt" height="50pt" viewBox="0 0 50 50" version="1.1">
<g id="surface1">
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(100%,100%,100%);fill-opacity:1;" d="M 49.8125 24.96875 C 49.8125 38.597656 38.765625 49.648438 25.136719 49.648438 C 11.503906 49.648438 0.457031 38.597656 0.457031 24.96875 C 0.457031 11.339844 11.503906 0.289062 25.136719 0.289062 C 38.765625 0.289062 49.8125 11.339844 49.8125 24.96875 Z M 49.8125 24.96875 "/>
<path style=" stroke:none;fill-rule:nonzero;fill:rgb(0%,0%,0%);fill-opacity:1;" d="M 23.300781 49.742188 C 12.609375 49.1875 2.980469 40.855469 0.789062 30.402344 C -1.230469 21.671875 1.929688 12.011719 8.773438 6.214844 C 13.628906 1.992188 20.15625 -0.234375 26.582031 0.25 C 36.761719 0.664062 46.082031 8.207031 48.824219 17.992188 C 49.949219 21.589844 49.945312 25.449219 49.492188 29.152344 C 47.945312 38.582031 40.527344 46.730469 31.226562 49.007812 C 28.65625 49.640625 25.945312 49.96875 23.300781 49.742188 Z M 19.492188 48.222656 C 14.957031 45.996094 12.152344 40.835938 12.796875 35.820312 C 13.308594 29.902344 18.691406 25.015625 24.605469 24.910156 C 29.558594 25.0625 34.441406 21.984375 36.242188 17.335938 C 38.398438 12.253906 36.535156 5.875 31.957031 2.773438 C 28.207031 0.0078125 23.183594 0.59375 18.914062 1.554688 C 9.042969 3.972656 1.410156 13.21875 0.859375 23.359375 C 0.140625 32.511719 5.179688 41.75 13.242188 46.128906 C 15.261719 47.21875 18.128906 48.496094 20.015625 48.519531 L 19.808594 48.394531 Z M 24.320312 15.75 C 21.820312 15.269531 21.066406 11.597656 23.21875 10.207031 C 25.429688 8.488281 28.898438 10.828125 28.027344 13.554688 C 27.628906 15.125 25.890625 16.113281 24.320312 15.75 Z M 25.574219 40.082031 C 28.640625 39.699219 28.71875 34.789062 25.660156 34.324219 C 23.238281 33.691406 21.132812 36.71875 22.5625 38.78125 C 23.167969 39.699219 24.460938 40.425781 25.574219 40.082031 Z M 25.574219 40.082031 "/>
</g>
</svg>
<a title="" href="/">lin<sup>2</sup></a></div><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></div><nav class="navigation">
        <ul><li class="navigation__item"><a href="/archive.html">Archive</a></li><li class="navigation__item"><a href="/about.html">About</a></li><li><button class="button button--secondary button--circle search-button js-search-toggle"><i class="fas fa-search"></i></button></li></ul>
      </nav></div>
  </header>
</div><div class="page__content"><div class ="main"><div class="grid grid--reverse">

              <div class="col-aside d-print-none js-col-aside"><aside class="page__aside js-page-aside"><div class="toc-aside js-toc-root"></div>
</aside></div>

              <div class="col-main cell cell--auto"><!-- start custom main top snippet -->

<!-- end custom main top snippet -->
<article itemscope itemtype="http://schema.org/Article"><div class="article__header"><header><h1>Create PDF reports with Python and Jinja2</h1></header><span class="split-space">&nbsp;</span>
          <a class="edit-on-github"
            title="Edit on Github"
            href="https://github.com/Linlinzhao/linlinzhao.github.io/tree/master/_posts/2021-01-20-jinja-report.md">
            <i class="far fa-edit"></i></a></div><meta itemprop="headline" content="Create PDF reports with Python and Jinja2"><div class="article__info clearfix"><ul class="left-col menu"><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=python">python</a>
            </li><li>
              <a class="button button--secondary button--pill button--sm"
                href="/archive.html?tag=jinja">jinja</a>
            </li></ul><ul class="right-col menu"><li><i class="far fa-calendar-alt"></i> <span>Jan 20, 2021</span>
            </li></ul></div><meta itemprop="author" content="Linlin Zhao, PhD"/><meta itemprop="datePublished" content="2021-01-20T00:00:00+01:00">
    <meta itemprop="keywords" content="python,jinja"><div class="js-article-content"><div class="layout--article"><!-- start custom article top snippet -->

<!-- end custom article top snippet -->
<div class="article__content" itemprop="articleBody"><p><em>This post is a summary of the code I wrote in Python for my then-desperate wife to automatically generate hundreds of invoices.</em></p>

<p>Suppose you have an excel sheet with hundreds of rows and a couple of columns (a sample is shown below), and would like to generate pdf reports for individual rows according to column values. 
With MS office, the sheet can be imported into a word template and the column names of interest can be placed accordingly in the template. 
Then you can print pdf files for every row. However the task can easily become tedious when you have additional requirements. 
For instance, grouping customers by attributes like regions to different folders and naming the printed files with column values would need manual and repetitive efforts. 
To automate the process with Python, there are many <a href="https://www.xlwings.org/blog/reporting-with-python">options</a> to choose from.
The major tool we’ll make use of is <a href="https://jinja2docs.readthedocs.io/en/stable/">Jinja2</a>. 
In addition, we use pandas to handle tables and test a couple of html-to-pdf tools.</p>

<h2 id="what-is-jinja2">What is Jinja2?</h2>

<p>This is excerpted from Jinja2’s documentation:</p>
<blockquote>
  <p>Jinja2 is a modern and designer-friendly templating language for Python, modelled after Django’s templates. It is fast, widely used and secure with the optional sandboxed template execution environment.</p>
</blockquote>

<blockquote>
  <p>The name Jinja was chosen because it’s the name of a Japanese temple and temple and template share a similar pronunciation. It is not named after the city in Uganda.</p>
</blockquote>

<p>In a nutshell, Jinja bridges our Python code and html files which will be shown to end users. 
By placing placeholders `` in a html template, in Python, Jinja can pass actual values to the placeholders when rendering html files. 
If this sounds too abstract, the concept will become clear when we see the code later.</p>

<h2 id="a-concrete-but-simple-example">A concrete but simple example</h2>

<p>Let’s generate invoices according to the following sales table:</p>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Invoice</th>
      <th>Name</th>
      <th>Address</th>
      <th>Item</th>
      <th>Cost</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>A0001</td>
      <td>Alix</td>
      <td>Volkstr. 1</td>
      <td>book</td>
      <td>12Euro</td>
    </tr>
    <tr>
      <td>2</td>
      <td>A0002</td>
      <td>Juli</td>
      <td>Volkstr. 2</td>
      <td>laptop</td>
      <td>500Euro</td>
    </tr>
    <tr>
      <td>3</td>
      <td>A0628</td>
      <td>Ruo</td>
      <td>Volkstr. 3</td>
      <td>laptop</td>
      <td>1245Euro</td>
    </tr>
  </tbody>
</table>

<p>Each customer needs an invoice pdf file which is named by the customer’s name. 
Our basic idea is to first generate html files and then convert them to pdf files.</p>

<p>To start with, I have already composed a template html file based on this <a href="https://github.com/mjhea0/thinkful-mentor/tree/master/python/jinja">repo</a>:</p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
<span class="nt">&lt;head&gt;</span>
  <span class="nt">&lt;title&gt;</span>Rechnung<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">media=</span><span class="s">"screen"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
    <span class="nc">.container</span> <span class="p">{</span>
      <span class="nl">max-width</span><span class="p">:</span> <span class="m">800px</span><span class="p">;</span>
      <span class="nl">padding-top</span><span class="p">:</span> <span class="m">100px</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nt">p</span> <span class="p">{</span><span class="nl">font-size</span><span class="p">:</span> <span class="nb">medium</span><span class="p">;</span> <span class="nl">text-align</span><span class="p">:</span> <span class="nb">left</span><span class="p">;</span> <span class="nl">display</span><span class="p">:</span><span class="n">flex</span><span class="p">;</span> <span class="nl">flex-direction</span><span class="p">:</span> <span class="n">column</span><span class="p">}</span>
    <span class="nt">h4</span> <span class="p">{</span><span class="nl">text-align</span><span class="p">:</span> <span class="nb">center</span><span class="p">;}</span>
    <span class="nt">h3</span> <span class="p">{</span><span class="nl">text-align</span><span class="p">:</span><span class="nb">center</span><span class="p">;</span> <span class="nl">color</span><span class="p">:</span> <span class="nb">rgb</span><span class="p">(</span><span class="m">19</span><span class="p">,</span> <span class="m">17</span><span class="p">,</span> <span class="m">17</span><span class="p">);}</span>
  <span class="nt">&lt;/style&gt;</span>
<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"file:///home/linlin/projects/auto_report/jinja_report/yinyang1.png"</span> <span class="na">style=</span><span class="s">"float: left; WIDTH:80px; HEIGHT:80px"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;h3&gt;</span> <span class="nt">&lt;b&gt;</span>很酷的报告<span class="nt">&lt;/b&gt;&lt;/h3&gt;</span>
    <span class="nt">&lt;h4&gt;&lt;b&gt;</span>A cool report by Jinja2<span class="nt">&lt;/b&gt;&lt;/h4&gt;</span>
    
    <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">"text-align:center; font-size: small;"</span><span class="nt">&gt;</span>Volkstr. 001, 000000 Peaceland
    <span class="nt">&lt;br&gt;</span>
    Tel: 88-88888888,   Fax: 00-00000000
    <span class="nt">&lt;br&gt;</span>
    Email: abc@xxx.xx,   web: linlinzhao.com
    <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;br&gt;</span>
   <span class="nt">&lt;p&gt;</span>Name: <span class="nt">&lt;/p&gt;</span>
   <span class="nt">&lt;p&gt;</span>Address: <span class="nt">&lt;/p&gt;</span>
   <span class="c">&lt;!--ul&gt;
     
   &lt;/ul !--&gt;</span>
   <span class="nt">&lt;br&gt;</span>
   <span class="nt">&lt;br&gt;</span>
   <span class="nt">&lt;h5</span> <span class="na">style=</span><span class="s">"font-size: large;"</span><span class="nt">&gt;&lt;b&gt;</span>Rechnung<span class="nt">&lt;/b&gt;&lt;/h5&gt;</span>
   <span class="nt">&lt;p&gt;</span>Invoice No.: <span class="nt">&lt;/p&gt;</span>
   <span class="nt">&lt;p&gt;</span>Date: <span class="nt">&lt;/p&gt;</span>
   <span class="nt">&lt;p&gt;</span>Item: <span class="nt">&lt;/p&gt;</span>
   <span class="nt">&lt;p&gt;</span>Cost: <span class="nt">&lt;/p&gt;</span>

    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;p&gt;</span>
    Beautiful is better than ugly.<span class="nt">&lt;br&gt;</span>
    Explicit is better than implicit.<span class="nt">&lt;br&gt;</span>
    Simple is better than complex.<span class="nt">&lt;br&gt;</span>
    Complex is better than complicated.<span class="nt">&lt;br&gt;</span>
    Flat is better than nested.<span class="nt">&lt;br&gt;</span>
    Sparse is better than dense.<span class="nt">&lt;br&gt;</span>
    Readability counts.<span class="nt">&lt;br&gt;</span>
    Special cases aren't special enough to break the rules.<span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;h5</span> <span class="na">style=</span><span class="s">"font-size: large;"</span><span class="nt">&gt;&lt;b&gt;</span>Bitte in einer Woche überweisen, vielen Dank!<span class="nt">&lt;/b&gt;&lt;/h5&gt;</span>
    <span class="nt">&lt;br&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"footer"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;p&gt;</span>Mit freundlichen Grüßen<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;br&gt;</span>
      <span class="nt">&lt;p&gt;</span>一家很赚钱的公司<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;p&gt;</span>A very profitable company<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;br&gt;</span>
        <span class="nt">&lt;br&gt;</span>

        <span class="nt">&lt;p</span> <span class="na">style=</span><span class="s">"font-size: x-small;"</span><span class="nt">&gt;</span>Kontoinhaber: NN<span class="nt">&lt;br&gt;</span>
        Eingutbank<span class="nt">&lt;br&gt;</span>
        Bankleitzahl: 000 000 00   Kontonummer:  000000000<span class="nt">&lt;br&gt;</span>
        IBAN: XX00 0000 0000 0000 0000 00  BIC: XXXXXXXX  <span class="nt">&lt;/p&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://code.jquery.com/jquery-1.10.2.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<p>This is how the template looks like:</p>

<p><img src="/assets/images/jinja_template.png" alt="template" /></p>

<p>As you may see from the template, the column names in our table have corresponding placeholders.</p>

<h2 id="use-jinja-to-render-html-files">Use Jinja to render html files</h2>

<p>Now we can write Python code to pass the values in the table to html files. The following function can render one html file for a given row.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">jinja2</span>

<span class="k">def</span> <span class="nf">render_html</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="s">"""
    Render html page using jinja
    """</span>
    <span class="n">template_loader</span> <span class="o">=</span> <span class="n">jinja2</span><span class="p">.</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">searchpath</span><span class="o">=</span><span class="s">"./"</span><span class="p">)</span>
    <span class="n">template_env</span> <span class="o">=</span> <span class="n">jinja2</span><span class="p">.</span><span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">template_loader</span><span class="p">)</span>
    <span class="n">template_file</span> <span class="o">=</span> <span class="s">"layout.html"</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">template_env</span><span class="p">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_file</span><span class="p">)</span>
    <span class="n">output_text</span> <span class="o">=</span> <span class="n">template</span><span class="p">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">row</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
        <span class="n">address</span><span class="o">=</span><span class="n">row</span><span class="p">.</span><span class="n">Address</span><span class="p">,</span>
        <span class="n">date</span><span class="o">=</span><span class="n">get_date</span><span class="p">(),</span>
        <span class="n">invoice</span><span class="o">=</span><span class="n">row</span><span class="p">.</span><span class="n">Invoice</span><span class="p">,</span>
        <span class="n">item</span><span class="o">=</span><span class="n">row</span><span class="p">.</span><span class="n">Item</span><span class="p">,</span>
        <span class="n">amount</span><span class="o">=</span><span class="n">row</span><span class="p">.</span><span class="n">Cost</span>
        <span class="p">)</span>

    <span class="n">html_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'</span><span class="si">{</span><span class="n">row</span><span class="p">.</span><span class="n">Name</span><span class="si">}</span><span class="s">.html'</span>
    <span class="n">html_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">html_path</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">html_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_text</span><span class="p">)</span>
    <span class="n">html_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></div>

<p>What this code does:</p>
<ol>
  <li>tell Jinja where the template is;</li>
  <li>pass values to the placeholder in the template when rendering;</li>
  <li>write the rendered output to a html file.</li>
</ol>

<h2 id="read-the-table-using-pandas">Read the table using Pandas</h2>

<p>The table is stored as <code class="language-plaintext highlighter-rouge">sample.csv</code>, we can use pandas to iterate through every row to have named tuples which can then be passed to <code class="language-plaintext highlighter-rouge">render_html</code>:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'sample.csv'</span><span class="p">)</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">itertuples</span><span class="p">():</span>
    <span class="n">render_html</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre></div></div>
<p>and three html files will be generated.</p>

<p><img src="/assets/images/jiaja_out_html.png" alt="htmls" />.</p>

<p>To check if the values are passed correctly, let’s view the <code class="language-plaintext highlighter-rouge">ruo.html</code>:</p>

<p><img src="/assets/images/jiaja_ruo.png" alt="ruo" /></p>

<p>The output actually looks all right, which is great.</p>

<h2 id="convert-html-to-pdf">Convert html to pdf</h2>

<p>In python, there are also several options for converting html to pdf, <a href="https://github.com/JazzCore/python-pdfkit">pdfkit</a>, <a href="https://weasyprint.org/">weasyprint</a>, <a href="https://xhtml2pdf.readthedocs.io/en/latest/">xhtml2pdf</a>, to name but a few.</p>

<p>Several factors like the template css style and the browser for viewing the html files can make the pdfs  look quite differently from what you see from the browser. 
For instance, since the template html above has English, German and Chinese, we may need to specify encoding schemes for rendering all characters correctly. 
After playing different tools for a while, I have chosen <a href="https://github.com/JazzCore/python-pdfkit"><code class="language-plaintext highlighter-rouge">pdfkit</code></a>, which is a python wrapper for <code class="language-plaintext highlighter-rouge">wkhtmltopdf</code>. 
An exhaustive list of configurations can be found <a href="https://wkhtmltopdf.org/usage/wkhtmltopdf.txt">here</a>.</p>

<p>Again I have written a function for converting:</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">html2pdf</span><span class="p">(</span><span class="n">html_path</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">):</span>
    <span class="s">"""
    Convert html to pdf using pdfkit which is a wrapper of wkhtmltopdf
    """</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'page-size'</span><span class="p">:</span> <span class="s">'Letter'</span><span class="p">,</span>
        <span class="s">'margin-top'</span><span class="p">:</span> <span class="s">'0.35in'</span><span class="p">,</span>
        <span class="s">'margin-right'</span><span class="p">:</span> <span class="s">'0.75in'</span><span class="p">,</span>
        <span class="s">'margin-bottom'</span><span class="p">:</span> <span class="s">'0.75in'</span><span class="p">,</span>
        <span class="s">'margin-left'</span><span class="p">:</span> <span class="s">'0.75in'</span><span class="p">,</span>
        <span class="s">'encoding'</span><span class="p">:</span> <span class="s">"UTF-8"</span><span class="p">,</span>
        <span class="s">'no-outline'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">'enable-local-file-access'</span><span class="p">:</span> <span class="bp">None</span>
    <span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">html_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pdfkit</span><span class="p">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span>
</code></pre></div></div>
<p>Note that the specified options are from the <code class="language-plaintext highlighter-rouge">wkhtmltopdf</code> configuration list. For entries without values, simply specify them to be <code class="language-plaintext highlighter-rouge">None</code>.</p>

<h2 id="put-them-all-together">Put them all together</h2>

<p>To have clean working folder, directories <code class="language-plaintext highlighter-rouge">res</code> and <code class="language-plaintext highlighter-rouge">tables</code> are created for saving generated files and the original table respectively.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">jinja2</span>
<span class="kn">import</span> <span class="nn">pdfkit</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="n">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">date</span>

<span class="k">def</span> <span class="nf">render_html</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="s">"""
    Render html page using jinja based on layout.html
    """</span>
    <span class="n">template_loader</span> <span class="o">=</span> <span class="n">jinja2</span><span class="p">.</span><span class="n">FileSystemLoader</span><span class="p">(</span><span class="n">searchpath</span><span class="o">=</span><span class="s">"./"</span><span class="p">)</span>
    <span class="n">template_env</span> <span class="o">=</span> <span class="n">jinja2</span><span class="p">.</span><span class="n">Environment</span><span class="p">(</span><span class="n">loader</span><span class="o">=</span><span class="n">template_loader</span><span class="p">)</span>
    <span class="n">template_file</span> <span class="o">=</span> <span class="s">"layout.html"</span>
    <span class="n">template</span> <span class="o">=</span> <span class="n">template_env</span><span class="p">.</span><span class="n">get_template</span><span class="p">(</span><span class="n">template_file</span><span class="p">)</span>
    <span class="n">output_text</span> <span class="o">=</span> <span class="n">template</span><span class="p">.</span><span class="n">render</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="n">row</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span>
        <span class="n">address</span><span class="o">=</span><span class="n">row</span><span class="p">.</span><span class="n">Address</span><span class="p">,</span>
        <span class="n">date</span><span class="o">=</span><span class="n">get_date</span><span class="p">(),</span>
        <span class="n">invoice</span><span class="o">=</span><span class="n">row</span><span class="p">.</span><span class="n">Invoice</span><span class="p">,</span>
        <span class="n">item</span><span class="o">=</span><span class="n">row</span><span class="p">.</span><span class="n">Item</span><span class="p">,</span>
        <span class="n">amount</span><span class="o">=</span><span class="n">row</span><span class="p">.</span><span class="n">Cost</span>
        <span class="p">)</span>

    <span class="n">html_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'./res/</span><span class="si">{</span><span class="n">row</span><span class="p">.</span><span class="n">Name</span><span class="si">}</span><span class="s">.html'</span>
    <span class="n">html_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">html_path</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span>
    <span class="n">html_file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_text</span><span class="p">)</span>
    <span class="n">html_file</span><span class="p">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Now converting </span><span class="si">{</span><span class="n">row</span><span class="p">.</span><span class="n">Name</span><span class="si">}</span><span class="s"> ... "</span><span class="p">)</span>
    <span class="n">pdf_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s">'./res/</span><span class="si">{</span><span class="n">row</span><span class="p">.</span><span class="n">Name</span><span class="si">}</span><span class="s">.pdf'</span>    
    <span class="n">html2pdf</span><span class="p">(</span><span class="n">html_path</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">)</span>   

<span class="k">def</span> <span class="nf">html2pdf</span><span class="p">(</span><span class="n">html_path</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">):</span>
    <span class="s">"""
    Convert html to pdf using pdfkit which is a wrapper of wkhtmltopdf
    """</span>
    <span class="n">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">'page-size'</span><span class="p">:</span> <span class="s">'Letter'</span><span class="p">,</span>
        <span class="s">'margin-top'</span><span class="p">:</span> <span class="s">'0.35in'</span><span class="p">,</span>
        <span class="s">'margin-right'</span><span class="p">:</span> <span class="s">'0.75in'</span><span class="p">,</span>
        <span class="s">'margin-bottom'</span><span class="p">:</span> <span class="s">'0.75in'</span><span class="p">,</span>
        <span class="s">'margin-left'</span><span class="p">:</span> <span class="s">'0.75in'</span><span class="p">,</span>
        <span class="s">'encoding'</span><span class="p">:</span> <span class="s">"UTF-8"</span><span class="p">,</span>
        <span class="s">'no-outline'</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
        <span class="s">'enable-local-file-access'</span><span class="p">:</span> <span class="bp">None</span>
    <span class="p">}</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">html_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">pdfkit</span><span class="p">.</span><span class="n">from_file</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">pdf_path</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_date</span><span class="p">():</span>
    <span class="s">"Get today's date in German format"</span>
    <span class="n">today</span> <span class="o">=</span> <span class="n">date</span><span class="p">.</span><span class="n">today</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">today</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">"%d.%m.%Y"</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s">'tables/sample.csv'</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">itertuples</span><span class="p">():</span>
        <span class="n">render_html</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</code></pre></div></div>
<p>Running the script would generate both html files and pdf files for all rows. The code is also available on <a href="https://github.com/Linlinzhao/jinja-report">github</a>.</p>

<h3 id="code-dependencies">Code dependencies</h3>

<p>System wide: <code class="language-plaintext highlighter-rouge">wkhtmltopdf</code>, installers for different OS can be found <a href="https://wkhtmltopdf.org/downloads.html">here</a>.</p>

<p>Python3:</p>
<ul>
  <li>pdfkit</li>
  <li>jinja2</li>
  <li>pandas</li>
</ul>
</div><section class="article__sharing d-print-none"></section><div class="d-print-none"><footer class="article__footer"><meta itemprop="dateModified" content="2021-01-20T00:00:00+01:00"><!-- start custom article footer snippet -->

<!-- end custom article footer snippet -->
<div class="article__license"><div class="license">
    <p>This work is licensed under a <a itemprop="license" rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">Attribution-NonCommercial 4.0 International</a> license.
      <a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/">
        <img alt="Attribution-NonCommercial 4.0 International" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" />
      </a>
    </p>
  </div></div></footer>
<div class="article__section-navigator clearfix"><div class="previous"><span>PREVIOUS</span><a href="/tech/2020/07/24/remote-jupyterlab.html">Remote jupyterlab without SSH and sudo</a></div></div></div>

</div>

<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    $(function() {
      var $this ,$scroll;
      var $articleContent = $('.js-article-content');
      var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
      var scroll = hasSidebar ? '.js-page-main' : 'html, body';
      $scroll = $(scroll);

      $articleContent.find('.highlight').each(function() {
        $this = $(this);
        $this.attr('data-lang', $this.find('code').attr('data-lang'));
      });
      $articleContent.find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]').each(function() {
        $this = $(this);
        $this.append($('<a class="anchor d-print-none" aria-hidden="true"></a>').html('<i class="fas fa-anchor"></i>'));
      });
      $articleContent.on('click', '.anchor', function() {
        $scroll.scrollToAnchor('#' + $(this).parent().attr('id'), 400);
      });
    });
  });
})();
</script>
</div><section class="page__comments d-print-none"></section></article><!-- start custom main bottom snippet -->

<!-- end custom main bottom snippet -->
</div>
            </div></div></div><div class="page__footer d-print-none">
<footer class="footer py-4 js-page-footer">
  <div class="main"><div itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Linlin Zhao, PhD"><meta itemprop="url" content="/"><meta itemprop="description" content="I am a data scientist, an eager learner and a happy father"><div class="footer__author-links"><div class="author-links">
  <ul class="menu menu--nowrap menu--inline"></ul>
</div>
</div>
    </div><div class="site-info mt-2">
      <div>© lin<sup>2</sup> 2021,
        Powered by <a title="Jekyll is a simple, blog-aware, static site generator." href="http://jekyllrb.com/">Jekyll</a> & <a
        title="TeXt is a super customizable Jekyll theme." href="https://github.com/kitian616/jekyll-TeXt-theme">TeXt Theme</a>.
      </div>
    </div>
  </div>
</footer>
</div></div>
    </div><script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $body = $('body'), $window = $(window);
    var $pageRoot = $('.js-page-root'), $pageMain = $('.js-page-main');
    var activeCount = 0;
    function modal(options) {
      var $root = this, visible, onChange, hideWhenWindowScroll = false;
      var scrollTop;
      function setOptions(options) {
        var _options = options || {};
        visible = _options.initialVisible === undefined ? false : show;
        onChange = _options.onChange;
        hideWhenWindowScroll = _options.hideWhenWindowScroll;
      }
      function init() {
        setState(visible);
      }
      function setState(isShow) {
        if (isShow === visible) {
          return;
        }
        visible = isShow;
        if (visible) {
          activeCount++;
          scrollTop = $(window).scrollTop() || $pageMain.scrollTop();
          $root.addClass('modal--show');
          $pageMain.scrollTop(scrollTop);
          activeCount === 1 && ($pageRoot.addClass('show-modal'), $body.addClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.on('scroll', hide);
          $window.on('keyup', handleKeyup);
        } else {
          activeCount > 0 && activeCount--;
          $root.removeClass('modal--show');
          $window.scrollTop(scrollTop);
          activeCount === 0 && ($pageRoot.removeClass('show-modal'), $body.removeClass('of-hidden'));
          hideWhenWindowScroll && window.hasEvent('touchstart') && $window.off('scroll', hide);
          $window.off('keyup', handleKeyup);
        }
        onChange && onChange(visible);
      }
      function show() {
        setState(true);
      }
      function hide() {
        setState(false);
      }
      function handleKeyup(e) {
        // Char Code: 27  ESC
        if (e.which ===  27) {
          hide();
        }
      }
      setOptions(options);
      init();
      return {
        show: show,
        hide: hide,
        $el: $root
      };
    }
    $.fn.modal = modal;
  });
})();
</script><div class="modal modal--overflow page__search-modal d-print-none js-page-search-modal"><script>
(function () {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    // search panel
    var search = (window.search || (window.search = {}));
    var useDefaultSearchBox = window.useDefaultSearchBox === undefined ?
      true : window.useDefaultSearchBox ;

    var $searchModal = $('.js-page-search-modal');
    var $searchToggle = $('.js-search-toggle');
    var searchModal = $searchModal.modal({ onChange: handleModalChange, hideWhenWindowScroll: true });
    var modalVisible = false;
    search.searchModal = searchModal;

    var $searchBox = null;
    var $searchInput = null;
    var $searchClear = null;

    function getModalVisible() {
      return modalVisible;
    }
    search.getModalVisible = getModalVisible;

    function handleModalChange(visible) {
      modalVisible = visible;
      if (visible) {
        search.onShow && search.onShow();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].focus();
      } else {
        search.onShow && search.onHide();
        useDefaultSearchBox && $searchInput[0] && $searchInput[0].blur();
        setTimeout(function() {
          useDefaultSearchBox && ($searchInput.val(''), $searchBox.removeClass('not-empty'));
          search.clear && search.clear();
          window.pageAsideAffix && window.pageAsideAffix.refresh();
        }, 400);
      }
    }

    $searchToggle.on('click', function() {
      modalVisible ? searchModal.hide() : searchModal.show();
    });
    // Char Code: 83  S, 191 /
    $(window).on('keyup', function(e) {
      if (!modalVisible && !window.isFormElement(e.target || e.srcElement) && (e.which === 83 || e.which === 191)) {
        modalVisible || searchModal.show();
      }
    });

    if (useDefaultSearchBox) {
      $searchBox = $('.js-search-box');
      $searchInput = $searchBox.children('input');
      $searchClear = $searchBox.children('.js-icon-clear');
      search.getSearchInput = function() {
        return $searchInput.get(0);
      };
      search.getVal = function() {
        return $searchInput.val();
      };
      search.setVal = function(val) {
        $searchInput.val(val);
      };

      $searchInput.on('focus', function() {
        $(this).addClass('focus');
      });
      $searchInput.on('blur', function() {
        $(this).removeClass('focus');
      });
      $searchInput.on('input', window.throttle(function() {
        var val = $(this).val();
        if (val === '' || typeof val !== 'string') {
          search.clear && search.clear();
        } else {
          $searchBox.addClass('not-empty');
          search.onInputNotEmpty && search.onInputNotEmpty(val);
        }
      }, 400));
      $searchClear.on('click', function() {
        $searchInput.val(''); $searchBox.removeClass('not-empty');
        search.clear && search.clear();
      });
    }
  });
})();
</script><div class="search search--dark">
  <div class="main">
    <div class="search__header">Search</div>
    <div class="search-bar">
      <div class="search-box js-search-box">
        <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
        <input type="text" />
        <div class="search-box__icon-clear js-icon-clear">
          <a><i class="fas fa-times"></i></a>
        </div>
      </div>
      <button class="button button--theme-dark button--pill search__cancel js-search-toggle">
        Cancel</button>
    </div>
    <div class="search-result js-search-result"></div>
  </div>
</div>
<script>var SOURCES = window.TEXT_VARIABLES.sources;
var PAHTS = window.TEXT_VARIABLES.paths;
window.Lazyload.js([SOURCES.jquery, PAHTS.search_js], function() {
  var search = (window.search || (window.search = {}));
  var searchData = window.TEXT_SEARCH_DATA || {};

  function memorize(f) {
    var cache = {};
    return function () {
      var key = Array.prototype.join.call(arguments, ',');
      if (key in cache) return cache[key];
      else return cache[key] = f.apply(this, arguments);
    };
  }

  /// search
  function searchByQuery(query) {
    var i, j, key, keys, cur, _title, result = {};
    keys = Object.keys(searchData);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      for (j = 0; j < searchData[key].length; j++) {
        cur = searchData[key][j], _title = cur.title;
        if ((result[key] === undefined || result[key] && result[key].length < 4 )
          && _title.toLowerCase().indexOf(query.toLowerCase()) >= 0) {
          if (result[key] === undefined) {
            result[key] = [];
          }
          result[key].push(cur);
        }
      }
    }
    return result;
  }

  var renderHeader = memorize(function(header) {
    return $('<p class="search-result__header">' + header + '</p>');
  });

  var renderItem = function(index, title, url) {
    return $('<li class="search-result__item" data-index="' + index + '"><a class="button" href="' + url + '">' + title + '</a></li>');
  };

  function render(data) {
    if (!data) { return null; }
    var $root = $('<ul></ul>'), i, j, key, keys, cur, itemIndex = 0;
    keys = Object.keys(data);
    for (i = 0; i < keys.length; i++) {
      key = keys[i];
      $root.append(renderHeader(key));
      for (j = 0; j < data[key].length; j++) {
        cur = data[key][j];
        $root.append(renderItem(itemIndex++, cur.title, cur.url));
      }
    }
    return $root;
  }

  // search box
  var $result = $('.js-search-result'), $resultItems;
  var lastActiveIndex, activeIndex;

  function clear() {
    $result.html(null);
    $resultItems = $('.search-result__item'); activeIndex = 0;
  }
  function onInputNotEmpty(val) {
    $result.html(render(searchByQuery(val)));
    $resultItems = $('.search-result__item'); activeIndex = 0;
    $resultItems.eq(0).addClass('active');
  }

  search.clear = clear;
  search.onInputNotEmpty = onInputNotEmpty;

  function updateResultItems() {
    lastActiveIndex >= 0 && $resultItems.eq(lastActiveIndex).removeClass('active');
    activeIndex >= 0 && $resultItems.eq(activeIndex).addClass('active');
  }

  function moveActiveIndex(direction) {
    var itemsCount = $resultItems ? $resultItems.length : 0;
    if (itemsCount > 1) {
      lastActiveIndex = activeIndex;
      if (direction === 'up') {
        activeIndex = (activeIndex - 1 + itemsCount) % itemsCount;
      } else if (direction === 'down') {
        activeIndex = (activeIndex + 1 + itemsCount) % itemsCount;
      }
      updateResultItems();
    }
  }

  // Char Code: 13  Enter, 37  ⬅, 38  ⬆, 39  ➡, 40  ⬇
  $(window).on('keyup', function(e) {
    var modalVisible = search.getModalVisible && search.getModalVisible();
    if (modalVisible) {
      if (e.which === 38) {
        modalVisible && moveActiveIndex('up');
      } else if (e.which === 40) {
        modalVisible && moveActiveIndex('down');
      } else if (e.which === 13) {
        modalVisible && $resultItems && activeIndex >= 0 && $resultItems.eq(activeIndex).children('a')[0].click();
      }
    }
  });

  $result.on('mouseover', '.search-result__item > a', function() {
    var itemIndex = $(this).parent().data('index');
    itemIndex >= 0 && (lastActiveIndex = activeIndex, activeIndex = itemIndex, updateResultItems());
  });
});
</script>
</div></div>


<script>(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function scrollToAnchor(anchor, duration, callback) {
      var $root = this;
      $root.animate({ scrollTop: $(anchor).position().top }, duration, function() {
        window.history.replaceState(null, '', window.location.href.split('#')[0] + anchor);
        callback && callback();
      });
    }
    $.fn.scrollToAnchor = scrollToAnchor;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function affix(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroll,
        offsetBottom = 0, scrollTarget = window, scroll = window.document, disabled = false, isOverallScroller = true,
        rootTop, rootLeft, rootHeight, scrollBottom, rootBottomTop,
        hasInit = false, curState;

      function setOptions(options) {
        var _options = options || {};
        _options.offsetBottom && (offsetBottom = _options.offsetBottom);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroll && (scroll = _options.scroll);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $scrollTarget = $(scrollTarget);
        isOverallScroller = window.isOverallScroller($scrollTarget[0]);
        $scroll = $(scroll);
      }
      function preCalc() {
        top();
        rootHeight = $root.outerHeight();
        rootTop = $root.offset().top + (isOverallScroller ? 0 :  $scrollTarget.scrollTop());
        rootLeft = $root.offset().left;
      }
      function calc(needPreCalc) {
        needPreCalc && preCalc();
        scrollBottom = $scroll.outerHeight() - offsetBottom - rootHeight;
        rootBottomTop = scrollBottom - rootTop;
      }
      function top() {
        if (curState !== 'top') {
          $root.removeClass('fixed').css({
            left: 0,
            top: 0
          });
          curState = 'top';
        }
      }
      function fixed() {
        if (curState !== 'fixed') {
          $root.addClass('fixed').css({
            left: rootLeft + 'px',
            top: 0
          });
          curState = 'fixed';
        }
      }
      function bottom() {
        if (curState !== 'bottom') {
          $root.removeClass('fixed').css({
            left: 0,
            top: rootBottomTop + 'px'
          });
          curState = 'bottom';
        }
      }
      function setState() {
        var scrollTop = $scrollTarget.scrollTop();
        if (scrollTop >= rootTop && scrollTop <= scrollBottom) {
          fixed();
        } else if (scrollTop < rootTop) {
          top();
        } else {
          bottom();
        }
      }
      function init() {
        if(!hasInit) {
          var interval, timeout;
          calc(true); setState();
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState();
          });
          $window.on('resize', function() {
            disabled || (calc(true), setState());
          });
          hasInit = true;
        }
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions,
        refresh: function() {
          calc(true, { animation: false }); setState();
        }
      };
    }
    $.fn.affix = affix;
  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    function toc(options) {
      var $root = this, $window = $(window), $scrollTarget, $scroller, $tocUl = $('<ul class="toc toc--ellipsis"></ul>'), $tocLi, $headings, $activeLast, $activeCur,
        selectors = 'h1,h2,h3', container = 'body', scrollTarget = window, scroller = 'html, body', disabled = false,
        headingsPos, scrolling = false, hasRendered = false, hasInit = false;

      function setOptions(options) {
        var _options = options || {};
        _options.selectors && (selectors = _options.selectors);
        _options.container && (container = _options.container);
        _options.scrollTarget && (scrollTarget = _options.scrollTarget);
        _options.scroller && (scroller = _options.scroller);
        _options.disabled !== undefined && (disabled = _options.disabled);
        $headings = $(container).find(selectors).filter('[id]');
        $scrollTarget = $(scrollTarget);
        $scroller = $(scroller);
      }
      function calc() {
        headingsPos = [];
        $headings.each(function() {
          headingsPos.push(Math.floor($(this).position().top));
        });
      }
      function setState(element, disabled) {
        var scrollTop = $scrollTarget.scrollTop(), i;
        if (disabled || !headingsPos || headingsPos.length < 1) { return; }
        if (element) {
          $activeCur = element;
        } else {
          for (i = 0; i < headingsPos.length; i++) {
            if (scrollTop >= headingsPos[i]) {
              $activeCur = $tocLi.eq(i);
            } else {
              $activeCur || ($activeCur = $tocLi.eq(i));
              break;
            }
          }
        }
        $activeLast && $activeLast.removeClass('active');
        ($activeLast = $activeCur).addClass('active');
      }
      function render() {
        if(!hasRendered) {
          $root.append($tocUl);
          $headings.each(function() {
            var $this = $(this);
            $tocUl.append($('<li></li>').addClass('toc-' + $this.prop('tagName').toLowerCase())
              .append($('<a></a>').text($this.text()).attr('href', '#' + $this.prop('id'))));
          });
          $tocLi = $tocUl.children('li');
          $tocUl.on('click', 'a', function(e) {
            e.preventDefault();
            var $this = $(this);
            scrolling = true;
            setState($this.parent());
            $scroller.scrollToAnchor($this.attr('href'), 400, function() {
              scrolling = false;
            });
          });
        }
        hasRendered = true;
      }
      function init() {
        var interval, timeout;
        if(!hasInit) {
          render(); calc(); setState(null, scrolling);
          // run calc every 100 millisecond
          interval = setInterval(function() {
            calc();
          }, 100);
          timeout = setTimeout(function() {
            clearInterval(interval);
          }, 45000);
          window.pageLoad.then(function() {
            setTimeout(function() {
              clearInterval(interval);
              clearTimeout(timeout);
            }, 3000);
          });
          $scrollTarget.on('scroll', function() {
            disabled || setState(null, scrolling);
          });
          $window.on('resize', window.throttle(function() {
            if (!disabled) {
              render(); calc(); setState(null, scrolling);
            }
          }, 100));
        }
        hasInit = true;
      }

      setOptions(options);
      if (!disabled) {
        init();
      }
      $window.on('resize', window.throttle(function() {
        init();
      }, 200));
      return {
        setOptions: setOptions
      };
    }
    $.fn.toc = toc;
  });
})();
/*(function () {

})();*/
</script><script>
  /* toc must before affix, since affix need to konw toc' height. */(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  var TOC_SELECTOR = window.TEXT_VARIABLES.site.toc.selectors;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window);
    var $articleContent = $('.js-article-content');
    var $tocRoot = $('.js-toc-root'), $col2 = $('.js-col-aside');
    var toc;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');
    var hasToc = $articleContent.find(TOC_SELECTOR).length > 0;

    function disabled() {
      return $col2.css('display') === 'none' || !hasToc;
    }

    tocDisabled = disabled();

    toc = $tocRoot.toc({
      selectors: TOC_SELECTOR,
      container: $articleContent,
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      tocDisabled = disabled();
      toc && toc.setOptions({
        disabled: tocDisabled
      });
    }, 100));

  });
})();
(function() {
  var SOURCES = window.TEXT_VARIABLES.sources;
  window.Lazyload.js(SOURCES.jquery, function() {
    var $window = $(window), $pageFooter = $('.js-page-footer');
    var $pageAside = $('.js-page-aside');
    var affix;
    var tocDisabled = false;
    var hasSidebar = $('.js-page-root').hasClass('layout--page--sidebar');

    affix = $pageAside.affix({
      offsetBottom: $pageFooter.outerHeight(),
      scrollTarget: hasSidebar ? '.js-page-main' : null,
      scroller: hasSidebar ? '.js-page-main' : null,
      scroll: hasSidebar ? $('.js-page-main').children() : null,
      disabled: tocDisabled
    });

    $window.on('resize', window.throttle(function() {
      affix && affix.setOptions({
        disabled: tocDisabled
      });
    }, 100));

    window.pageAsideAffix = affix;
  });
})();
</script><!--script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> 
</script --><script type="text/x-mathjax-config">
	var _config = { tex2jax: {
		inlineMath: [['$','$'], ['\\(','\\)']]
	}};MathJax.Hub.Config(_config);
</script>
<script type="text/javascript" src="https://cdn.bootcss.com/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML" async></script>

    </div>
    <script>(function () {
  var $root = document.getElementsByClassName('root')[0];
  if (window.hasEvent('touchstart')) {
    $root.dataset.isTouch = true;
    document.addEventListener('touchstart', function(){}, false);
  }
})();
</script>
  </body>
</html>

